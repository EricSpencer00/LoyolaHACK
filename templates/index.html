{% extends 'base.html' %}
{% block title %}Home - CTA Transit Tracker{% endblock %}

{% block content %}
<div class="container my-5 text-center">
  <h1 class="display-4">Welcome to CTA Transit Tracker</h1>
  <p class="lead">Track real-time CTA buses and trains with predictive analytics.</p>
  <button id="google-signin" class="btn btn-primary btn-lg">Sign In with Google</button>

  <div class="card mx-auto mt-5" style="max-width: 600px;">
    <div class="card-header">
      Live Transit Map
    </div>
    <div class="card-body p-0">
      <!-- Smaller, simpler map -->
      <div id="map" style="height: 300px;"></div>
    </div>
  </div>
</div>

<script>
  const auth = firebase.auth();
  const provider = new firebase.auth.GoogleAuthProvider();

  document.getElementById('google-signin').addEventListener('click', () => {
    auth.signInWithPopup(provider)
      .then((result) => {
        result.user.getIdToken().then(token => {
          fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token })
          }).then(response => {
            if (response.ok) {
              window.location.href = "/dashboard";
            }
          });
        });
      })
      .catch((error) => console.error('Google Sign-In error:', error));
  });
</script>

{% endblock %}
